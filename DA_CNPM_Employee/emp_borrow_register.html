<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng k√Ω m∆∞·ª£n</title>
    <link rel="stylesheet" href="./assets/css/emp_header.css">
    <link rel="stylesheet" href="./assets/css/emp_borrow_register.css">
</head>
<body>
    <header class="header" id="header"></header>

    <div class="main-container">
        <aside class="sidebar">
            <h3>
                <img src="./assets/img/emp_managedocs_icondanhmuc.svg" alt="Danh m·ª•c Icon" class="icon"> 
                DANH M·ª§C
            </h3>
            <ul>
                <li><a href="/emp_borrow_register.html">ƒêƒÉng k√Ω m∆∞·ª£n</a></li>
                <li><a href="/emp_requestextension.html">Y√™u c·∫ßu gia h·∫°n</a></li>
                <li><a href="/emp_bookreturnconfirm.html">X√°c nh·∫≠n tr·∫£ s√°ch</a></li>
                <li><a href="/emp_overduenotice.html">Th√¥ng b√°o qu√° h·∫°n</a></li>
            </ul>
        </aside>

        <section class="content">
            <h2>ƒêƒÇNG K√ù M∆Ø·ª¢N</h2>

            <div class="loan-table-container">
                <table class="loan-table" id="loan-table">
                    <thead>
                        <tr>
                            <th>CCCD <span class="filter-icon" onclick="sortTable(0)">üîΩ</span></th>
                            <th>ID s√°ch <span class="filter-icon" onclick="sortTable(1)">üîΩ</span></th>
                            <th>T√™n s√°ch <span class="filter-icon" onclick="sortTable(2)">üîΩ</span></th>
                            <th>Ng√†y y√™u c·∫ßu <span class="filter-icon" onclick="sortTable(3, true)">üîΩ</span></th>
                            <th>Ng√†y h·∫πn tr·∫£ <span class="filter-icon" onclick="sortTable(4, true)">üîΩ</span></th>
                            <th>
                                X·ª≠ l√Ω y√™u c·∫ßu
                                <select id="filterStatus">
                                    <option value="T·∫•t c·∫£">T·∫•t c·∫£</option>
                                    <option value="ƒê√£ x·ª≠ l√Ω">ƒê√£ x·ª≠ l√Ω</option>
                                    <option value="Duy·ªát | T·ª´ ch·ªëi">Ch∆∞a x·ª≠ l√Ω</option>
                                </select>                                                              
                            </th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr>
                            <td>079201200124</td>
                            <td>MT1003</td>
                            <td>Gi·∫£i t√≠ch 1</td>
                            <td>05/02/2024</td>
                            <td>01/03/2024</td>
                            <td class="status processed">ƒê√£ x·ª≠ l√Ω</td>
                        </tr>
                        <tr>
                            <td>091343356418</td>
                            <td>MT2013</td>
                            <td>X√°c su·∫•t th·ªëng k√™</td>
                            <td>12/03/2024</td>
                            <td>11/04/2024</td>
                            <td class="status approved-rejected">
                                <span class="approve" onclick="processRequest(this, 'approve')">Duy·ªát</span> | 
                                <span class="reject" onclick="processRequest(this, 'reject')">T·ª´ ch·ªëi</span>
                            </td>
                        </tr>
                        <tr>
                            <td>063789012345</td>
                            <td>CH1003</td>
                            <td>H√≥a ƒë·∫°i c∆∞∆°ng</td>
                            <td>20/04/2024</td>
                            <td>19/05/2024</td>
                            <td class="status approved-rejected">
                                <span class="approve" onclick="processRequest(this, 'approve')">Duy·ªát</span> | 
                                <span class="reject" onclick="processRequest(this, 'reject')">T·ª´ ch·ªëi</span>
                            </td>
                        </tr>
                        <tr>
                            <td>035456789012</td>
                            <td>PH1007</td>
                            <td>Th√≠ nghi·ªám v·∫≠t l√Ω</td>
                            <td>03/05/2024</td>
                            <td>01/06/2024</td>
                            <td class="status approved-rejected">
                                <span class="approve" onclick="processRequest(this, 'approve')">Duy·ªát</span> | 
                                <span class="reject" onclick="processRequest(this, 'reject')">T·ª´ ch·ªëi</span>
                            </td>
                        </tr>
                        <tr>
                            <td>098765432109</td>
                            <td>SP1035</td>
                            <td>Ch·ªß nghƒ©a x√£ h·ªôi khoa h·ªçc</td>
                            <td>11/06/2024</td>
                            <td>14/08/2024</td>
                            <td class="status processed">ƒê√£ x·ª≠ l√Ω</td>
                        </tr>
                        <tr>
                            <td>052345678901</td>
                            <td>IM1025</td>
                            <td>Qu·∫£n l√Ω d·ª± √°n cho k·ªπ s∆∞</td>
                            <td>23/08/2024</td>
                            <td>22/09/2024</td>
                            <td class="status approved-rejected">
                                <span class="approve" onclick="processRequest(this, 'approve')">Duy·ªát</span> | 
                                <span class="reject" onclick="processRequest(this, 'reject')">T·ª´ ch·ªëi</span>
                            </td>
                        </tr>
                        <tr>
                            <td>089012302137</td>
                            <td>CO2013</td>
                            <td>H·ªá c∆° s·ªü d·ªØ li·ªáu</td>
                            <td>30/09/2024</td>
                            <td>29/10/2024</td>
                            <td class="status approved-rejected">
                                <span class="approve" onclick="processRequest(this, 'approve')">Duy·ªát</span> | 
                                <span class="reject" onclick="processRequest(this, 'reject')">T·ª´ ch·ªëi</span>
                            </td>
                        </tr>
                        <tr>
                            <td>098033432346</td>
                            <td>CO3001</td>
                            <td>C√¥ng ngh·ªá ph·∫ßn m·ªÅm</td>
                            <td>15/07/2024</td>
                            <td>13/09/2024</td>
                            <td class="status processed">ƒê√£ x·ª≠ l√Ω</td>
                        </tr>
                        <tr>
                            <td>089012345678</td>
                            <td>AS3077</td>
                            <td>C∆° s·ªü v·∫≠t l√Ω s·ª£i quang h·ªçc v√† ·ª©ng d·ª•ng</td>
                            <td>18/08/2024</td>
                            <td>28/08/2024</td>
                            <td class="status approved-rejected">
                                <span class="approve" onclick="processRequest(this, 'approve')">Duy·ªát</span> | 
                                <span class="reject" onclick="processRequest(this, 'reject')">T·ª´ ch·ªëi</span>
                            </td>
                        </tr>
                        <tr>
                            <td>090123456789</td>
                            <td>TR3077</td>
                            <td>Th√≠ nghi·ªám k·ªπ thu·∫≠t h√†ng kh√¥ng 1</td>
                            <td>14/12/2024</td>
                            <td>26/12/2024</td>
                            <td class="status approved-rejected">
                                <span class="approve" onclick="processRequest(this, 'approve')">Duy·ªát</span> | 
                                <span class="reject" onclick="processRequest(this, 'reject')">T·ª´ ch·ªëi</span>
                            </td>
                        </tr>
                        <tr>
                            <td>078901234567</td>
                            <td>ME3005</td>
                            <td>Thi·∫øt k·∫ø h·ªá th·ªëng c∆° ƒëi·ªán t·ª≠</td>
                            <td>10/07/2024</td>
                            <td>09/08/2024</td>
                            <td class="status approved-rejected">
                                <span class="approve" onclick="processRequest(this, 'approve')">Duy·ªát</span> | 
                                <span class="reject" onclick="processRequest(this, 'reject')">T·ª´ ch·ªëi</span>
                            </td>
                        </tr>
                        <tr>
                            <td>093456789012</td>
                            <td>EE2009</td>
                            <td>H·ªá th·ªëng m√°y t√≠nh v√† ng√¥n ng·ªØ l·∫≠p tr√¨nh</td>
                            <td>06/12/2024</td>
                            <td>10/01/2025</td>
                            <td class="status approved-rejected">
                                <span class="approve" onclick="processRequest(this, 'approve')">Duy·ªát</span> | 
                                <span class="reject" onclick="processRequest(this, 'reject')">T·ª´ ch·ªëi</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <script src="script.js"></script>
    <script>
        async function loadHeader() {
            const headerContainer = document.getElementById("header");
            const response = await fetch("emp_header.html");
            const headerHTML = await response.text();
            headerContainer.innerHTML = headerHTML;
        }
        loadHeader();

        // Bi·∫øn l∆∞u tr·∫°ng th√°i s·∫Øp x·∫øp c·ªßa t·ª´ng c·ªôt
        const sortStates = [true, true, true, true, true]; // True = A-Z, False = Z-A

        // H√†m l·ªçc tr·∫°ng th√°i "X·ª≠ l√Ω y√™u c·∫ßu"
        function filterTableByStatus() {
            const filterValue = document.getElementById("filterStatus").value;
            const rows = document.querySelectorAll(".loan-table tbody tr");

            rows.forEach(row => {
                const statusCell = row.cells[5]; // √î ch·ª©a tr·∫°ng th√°i "X·ª≠ l√Ω y√™u c·∫ßu"
                const cellContent = statusCell.textContent.trim(); // ƒêo·∫°n text ho√†n ch·ªânh c·ªßa √¥
                const hasApproveReject = statusCell.querySelector(".approve") && statusCell.querySelector(".reject"); // Ki·ªÉm tra xem c√≥ ch·ª©a "Duy·ªát" v√† "T·ª´ ch·ªëi" kh√¥ng

                // Ki·ªÉm tra ƒëi·ªÅu ki·ªán l·ªçc
                if (filterValue === "T·∫•t c·∫£" ||
                    (filterValue === "ƒê√£ x·ª≠ l√Ω" && cellContent === "ƒê√£ x·ª≠ l√Ω") ||
                    (filterValue === "Duy·ªát | T·ª´ ch·ªëi" && hasApproveReject)) {
                    row.style.display = ""; // Hi·ªÉn th·ªã h√†ng n·∫øu th·ªèa m√£n
                } else {
                    row.style.display = "none"; // ·∫®n h√†ng n·∫øu kh√¥ng th·ªèa m√£n
                }
            });
        }

        // S·ª± ki·ªán cho b·ªô l·ªçc
        document.getElementById("filterStatus").addEventListener("change", filterTableByStatus);

        // H√†m s·∫Øp x·∫øp b·∫£ng
        function sortTable(columnIndex, isDate = false) {
            const table = document.getElementById("loan-table");
            const rows = Array.from(table.querySelectorAll("tbody tr"));
            const sortDirection = sortStates[columnIndex];
            sortStates[columnIndex] = !sortStates[columnIndex]; // ƒê·ªïi tr·∫°ng th√°i s·∫Øp x·∫øp

            rows.sort((a, b) => {
                const cellA = a.cells[columnIndex].textContent.trim();
                const cellB = b.cells[columnIndex].textContent.trim();

                // Ki·ªÉm tra n·∫øu c·ªôt l√† ng√†y th√°ng
                if (isDate) {
                    const dateA = new Date(cellA.split("/").reverse().join("-"));
                    const dateB = new Date(cellB.split("/").reverse().join("-"));
                    return sortDirection ? dateA - dateB : dateB - dateA;
                } else {
                    return sortDirection 
                        ? cellA.localeCompare(cellB, 'vi', { numeric: true }) 
                        : cellB.localeCompare(cellA, 'vi', { numeric: true });
                }
            });

            rows.forEach(row => table.querySelector("tbody").appendChild(row));
        }

        // X·ª≠ l√Ω y√™u c·∫ßu "Duy·ªát" v√† "T·ª´ ch·ªëi"
        function processRequest(element, action) {
            const row = element.closest("tr");
            const statusCell = row.querySelector(".status");

            if (action === "approve") {
                alert("ƒêƒÉng k√Ω m∆∞·ª£n ƒë√£ ƒë∆∞·ª£c duy·ªát th√†nh c√¥ng");
                statusCell.textContent = "ƒê√£ x·ª≠ l√Ω";
            } else if (action === "reject") {
                alert("ƒêƒÉng k√Ω m∆∞·ª£n b·ªã t·ª´ ch·ªëi");
                statusCell.textContent = "ƒê√£ x·ª≠ l√Ω";
            }
            statusCell.className = "status processed"; // Thay ƒë·ªïi class ƒë·ªÉ ph√¢n lo·∫°i
        }
    </script>
</body>
</html> 